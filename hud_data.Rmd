---
title: "HUD"
author: "Lamar Foster"
date: "7/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rio)
library(dplyr)
library(janitor)
library(tidyr)
library(stringr)
```


```{r}
hud10_11 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2011f/fy2011_equiv_zc_rents_acs.xls")
hud12 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2012f/small_area_fmrs_fy2012.xls")
hud13 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2013p/small_area_fmrs_fy2013.xls")
hud14 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2014f/small_area_fmrs_fy2014.xls")
hud15 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2015f/small_area_fmrs_fy2015f.xls")
hud16 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2016f/final_fy2016_hypothetical_safmrs.xlsx")
hud17 <- import(file = "https://www.huduser.gov/portal/datasets/fmr/fmr2017/FY2017_hypothetical_safmrs.xlsx")
```

```{r}
hud10_11 <- hud10_11 %>% clean_names()
hud15 <- hud15 %>% clean_names()
hud16 <- hud16 %>% clean_names()
hud17 <- hud17 %>% clean_names()

```

```{r}
#Combine hud 12-14
hud12 <- hud12 %>% 
  mutate(year = 2012)

hud13 <- hud13 %>% 
  mutate(year = 2013)

hud14 <- hud14 %>% 
  mutate(year = 2014)

hud12_14 <- bind_rows(hud12, hud13, hud14) %>% clean_names() %>% 
  select(-c(state, state_name, county))

```

```{r}
hud10_11 <- hud10_11 %>% 
  select(-c(state, county)) %>% 
rename(
cbsa = cbsamet) %>% 
  mutate(year = 2011)
```

```{r}
hud15 <- hud15 %>% 
  select(-c(state, statename, county)) %>% 
rename(
cbsa = cbsamet,
county_name = cntyname,
zip = zipcode,
cbsa_name = cbnsmcnm) %>% 
  mutate(year = 2015)
```

```{r}
hud16 <- hud16 %>% 
  select(-c(fips_state_code, fips_county_code, statename)) %>% 
rename(
cbsa = metro_code,
cbsa_name = metro_name,
zip = zip_code) %>% 
  mutate(year = 2016)
```

```{r}
hud17 <- hud17 %>% 
rename(
cbsa = metro_code,
cbsa_name = metro_name,
zip = zip_code) %>% 
  mutate(year = 2017)
```

```{r}
hud_full <- plyr::rbind.fill(hud12_14, hud10_11, hud15, hud16, hud17)
```

```{r}
hud_full %>% 
  separate(cbsa_name, into = c("city", "region"), sep = ",") %>%
  mutate(region = str_trim(region)) %>% 
  filter(region == "WA MSA") %>% 
  View()
```





















